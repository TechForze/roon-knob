name: CI

on:
  push: {}
  pull_request: {}

jobs:
  build-pc:
    name: Build PC Simulator
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: |
          brew install cmake ninja sdl2 curl
      - name: Configure & build
        run: |
          cmake -S pc_sim -B build/pc_sim -G Ninja
          cmake --build build/pc_sim
      - name: JSON unit test
        run: python tests/test_json_parse.py

  build-esp32s3:
    name: Build ESP32-S3 Firmware
    runs-on: ubuntu-latest
    container: espressif/idf:v5.4.1
    steps:
      - uses: actions/checkout@v4
      - name: Build ESP32-S3 firmware
        working-directory: idf_app
        run: |
          . $IDF_PATH/export.sh
          idf.py set-target esp32s3
          idf.py build

  build-esp32bt:
    name: Build ESP32 Bluetooth Firmware
    runs-on: ubuntu-latest
    container: espressif/idf:v5.4.1
    steps:
      - uses: actions/checkout@v4
      - name: Build ESP32 BT firmware
        working-directory: esp32_bt
        run: |
          . $IDF_PATH/export.sh
          idf.py set-target esp32
          idf.py build
